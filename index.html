<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RVC101 Photo Booth PRO</title>
<style>
  :root{
    --bg:#0b0f1a; --card:#12172a; --muted:#2a3354; --text:#e8edff; --accent:#6ee7ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,TH Sarabun New,Arial;
    color:var(--text);
    background:radial-gradient(1200px 600px at 70% -10%,#122,transparent), var(--bg);
    display:flex; min-height:100vh; align-items:center; justify-content:center; padding:18px;
  }
  .app{
    width:100%; max-width:720px;
    background:var(--card); border:1px solid #1e2540;
    border-radius:18px; padding:20px;
    box-shadow:0 10px 40px rgba(0,0,0,.5);
  }
  h1{text-align:center; font-size:22px; margin:0 0 14px;}
  .stage{
    position:relative; border-radius:14px; overflow:hidden;
    aspect-ratio:16/9; background:#000;
  }
  video, canvas{position:absolute; inset:0; width:100%; height:100%; object-fit:cover;}
  #framePreview{z-index:10; opacity:0.95; pointer-events:none;}
  .overlay-tip{
    position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,.6);
    padding:4px 8px; border-radius:8px; font-size:13px; z-index:11;
  }
  .controls{display:grid; gap:10px; margin-top:16px;}
  .row{display:flex; gap:8px; flex-wrap:wrap; justify-content:center;}
  button,label.btn{
    border:none; cursor:pointer; padding:12px 16px;
    border-radius:12px; font-weight:600; letter-spacing:.2px;
    color:#001018; background:linear-gradient(180deg,var(--accent),#4ad1f0);
    box-shadow:0 6px 16px rgba(78,221,255,.28);
    transition:transform .06s ease;
  }
  button.ghost,label.btn.ghost{background:#1b2240; color:#d6ddff;}
  button:active,label.btn:active{transform:translateY(1px);}
  input[type=file]{display:none}
  .frame-list{
    display:flex; overflow-x:auto; gap:8px; margin-top:10px; padding-bottom:4px;
  }
  .frame-thumb{
    flex:0 0 auto; width:80px; height:45px; border-radius:8px;
    border:2px solid transparent; cursor:pointer; overflow:hidden; position:relative;
  }
  .frame-thumb img{width:100%; height:100%; object-fit:cover;}
  .frame-thumb.active{border-color:#6ee7ff;}
  #qrcode canvas{width:160px!important; height:160px!important;}
</style>
</head>
<body>
<div class="app">
  <h1>üì∏ RVC101 E-Sports Challenge 2025 ‚Äì Photo Booth PRO</h1>

  <div class="stage" id="stage">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="framePreview"></canvas>
    <div class="overlay-tip">Align your face, then tap <b>Take Photo</b></div>
  </div>

  <!-- thumbnails -->
  <div class="frame-list" id="frameList"></div>

  <div class="controls">
    <div class="row">
      <label for="frameInput" class="btn ghost">üñºÔ∏è Upload Frames</label>
      <button id="openCam" class="ghost">üé• Open Camera</button>
    </div>
    <div class="row">
      <button id="snap">üì∑ Take Photo</button>
      <button id="retake" class="ghost">‚Ü©Ô∏è Retake</button>
    </div>
    <div class="row">
      <button id="download" disabled>‚¨áÔ∏è Download & QR</button>
      <button id="share" class="ghost" disabled>üîó Share</button>
    </div>
    <input id="frameInput" type="file" accept="image/png,image/*" multiple>
    <div id="qrcode" style="text-align:center;margin-top:10px;"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
const video=document.getElementById('video');
const frameCanvas=document.getElementById('framePreview');
const fctx=frameCanvas.getContext('2d');
const frameInput=document.getElementById('frameInput');
const frameList=document.getElementById('frameList');
let frames=[],currentFrameIndex=-1,stream=null,loopRun=false;

function openCamera(){
  navigator.mediaDevices.getUserMedia({video:true}).then(s=>{
    stream=s; video.srcObject=s;
  }).catch(e=>alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: "+e));
}
function startLoop(){
  if(loopRun) return;
  loopRun=true;
  const loop=()=>{
    if(!loopRun) return;
    frameCanvas.width=video.videoWidth;
    frameCanvas.height=video.videoHeight;
    fctx.clearRect(0,0,frameCanvas.width,frameCanvas.height);
    if(frames[currentFrameIndex]){
      fctx.drawImage(frames[currentFrameIndex],0,0,frameCanvas.width,frameCanvas.height);
    }
    requestAnimationFrame(loop);
  };
  loop();
}
function stopLoop(){loopRun=false;}

function selectFrame(i){
  currentFrameIndex=i;
  document.querySelectorAll('.frame-thumb').forEach((el,idx)=>{
    el.classList.toggle('active',idx===i);
  });
}
frameInput.addEventListener('change',e=>{
  const files=Array.from(e.target.files);
  frames=[]; frameList.innerHTML='';
  files.forEach((file,i)=>{
    const url=URL.createObjectURL(file);
    const img=new Image();
    img.onload=()=>{frames.push(img); if(currentFrameIndex===-1){currentFrameIndex=0; startLoop();}}
    img.src=url;

    // thumbnail
    const thumb=document.createElement('div');
    thumb.className='frame-thumb';
    thumb.innerHTML=`<img src="${url}">`;
    thumb.onclick=()=>selectFrame(i);
    frameList.appendChild(thumb);
  });
});

document.getElementById('openCam').onclick=openCamera;

document.getElementById('snap').onclick=()=>{
  if(!frames.length){alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏£‡∏≠‡∏ö");return;}
  const c=document.createElement('canvas');
  c.width=video.videoWidth; c.height=video.videoHeight;
  const ctx=c.getContext('2d');
  ctx.drawImage(video,0,0);
  if(frames[currentFrameIndex]) ctx.drawImage(frames[currentFrameIndex],0,0,c.width,c.height);
  const url=c.toDataURL('image/png');
  const a=document.createElement('a');
  a.href=url; a.download="rvc101-photo.png"; a.click();
  document.getElementById('qrcode').innerHTML='';
  new QRCode(document.getElementById('qrcode'), url);
  document.getElementById('download').disabled=false;
};
document.getElementById('retake').onclick=()=>{openCamera();startLoop();}
</script>
</body>
</html>
