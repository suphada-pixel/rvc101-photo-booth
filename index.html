<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RVC101 Photo Booth</title>
<style>
  :root{
    --bg:#0b0f1a; --card:#12172a; --muted:#2a3354; --text:#e8edff; --accent:#6ee7ff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,TH Sarabun New,Arial;
    color:var(--text); background:radial-gradient(1200px 600px at 70% -10%,#122,transparent), var(--bg);
    display:flex; min-height:100svh; align-items:center; justify-content:center; padding:18px;
  }
  .app{
    width:100%; max-width:480px; background:var(--card);
    border:1px solid #1e2540; border-radius:18px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);
  }
  h1{text-align:center; font-size:20px; margin:0 0 12px;}
  .stage{
    position:relative; border-radius:14px; overflow:hidden;
    aspect-ratio:16/9; background:#000; display:flex; align-items:center; justify-content:center;
  }
  video, canvas{position:absolute; inset:0; width:100%; height:100%; object-fit:cover;}
  #framePreview{z-index:10; opacity:0.95; pointer-events:none;}
  .overlay-tip{
    position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,.6);
    padding:4px 8px; border-radius:8px; font-size:12px; z-index:11;
  }
  .controls{display:grid; gap:10px; margin-top:12px}
  .row{display:flex; gap:8px}
  button,label.btn{
    border:none; cursor:pointer; width:100%; padding:12px 14px; border-radius:12px;
    font-weight:600; letter-spacing:.2px; color:#001018;
    background:linear-gradient(180deg,var(--accent),#4ad1f0);
    box-shadow:0 6px 16px rgba(78,221,255,.28);
    transition:transform .06s ease;
  }
  button:active,label.btn:active{transform:translateY(1px)}
  button.ghost{background:#1b2240; color:#d6ddff;}
  input[type=file]{display:none}
  #qrcode canvas{width:160px!important;height:160px!important}
</style>
</head>
<body>
<div class="app">
  <h1>üì∏ RVC101 E-Sports Challenge 2025 ‚Äì Photo Booth</h1>

  <div class="stage" id="stage">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="framePreview"></canvas>
    <div class="overlay-tip">Align your face, then tap <b>Take Photo</b></div>
  </div>

  <div class="controls">
    <div class="row">
      <label for="frameInput" class="btn ghost">üñºÔ∏è Upload Frame</label>
      <button id="openCam" class="ghost">üé• Open Camera</button>
    </div>
    <div class="row">
      <button id="snap">üì∑ Take Photo</button>
      <button id="retake" class="ghost">‚Ü©Ô∏è Retake</button>
    </div>
    <div class="row">
      <button id="download" disabled>‚¨áÔ∏è Download & QR</button>
      <button id="share" class="ghost" disabled>üîó Share</button>
    </div>
    <input id="frameInput" type="file" accept="image/png,image/*">
    <div id="qrcode" style="text-align:center;margin-top:10px;"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
const video=document.getElementById('video');
const frameCanvas=document.getElementById('framePreview');
const fctx=frameCanvas.getContext('2d');
const frameInput=document.getElementById('frameInput');
let frameImg=null, stream=null, running=false;

function openCamera(){
  navigator.mediaDevices.getUserMedia({video:true}).then(s=>{
    stream=s; video.srcObject=s;
  }).catch(e=>alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: "+e));
}
function startLoop(){
  if(running) return;
  running=true;
  const loop=()=>{
    if(!running) return;
    if(frameImg){
      frameCanvas.width=video.videoWidth;
      frameCanvas.height=video.videoHeight;
      fctx.clearRect(0,0,frameCanvas.width,frameCanvas.height);
      fctx.drawImage(frameImg,0,0,frameCanvas.width,frameCanvas.height);
    }
    requestAnimationFrame(loop);
  };
  loop();
}
function stopLoop(){running=false;}

frameInput.addEventListener('change',e=>{
  const file=e.target.files[0];
  if(!file) return;
  const url=URL.createObjectURL(file);
  frameImg=new Image();
  frameImg.onload=()=>{startLoop();}
  frameImg.src=url;
});

document.getElementById('openCam').onclick=openCamera;

document.getElementById('snap').onclick=()=>{
  const c=document.createElement('canvas');
  c.width=video.videoWidth;
  c.height=video.videoHeight;
  const ctx=c.getContext('2d');
  ctx.drawImage(video,0,0);
  if(frameImg) ctx.drawImage(frameImg,0,0,c.width,c.height);
  const url=c.toDataURL('image/png');
  const a=document.createElement('a');
  a.href=url; a.download="photo.png"; a.click();
  document.getElementById('qrcode').innerHTML='';
  new QRCode(document.getElementById('qrcode'), url);
};
document.getElementById('retake').onclick=()=>{stopLoop();openCamera();startLoop();}
</script>
</body>
</html>
